
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuditPro - 一站式审计工作台演示</title>
    
    <!-- 基础库加载 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 使用 UMD 版本的 Gemini SDK -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@1.38.0"
      }
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #ffffff;
            margin: 0;
            overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0a0a0a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #444; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- Types & Constants ---
        const AUDIT_AGENTS = [
            { id: 'risk', name: '风险识别智能体', description: '自动扫描文档中的潜在审计风险点' },
            { id: 'compliance', name: '合规校验智能体', description: '对比最新法规进行准则符合性检查' },
            { id: 'logic', name: '数据逻辑智能体', description: '核对财务报表间的勾稽关系' }
        ];

        const TEMPLATES = [
            { id: '1', name: '收入循环审计模板', program: '核查销售收入的真实性', process: '1. 抽取样本\n2. 检查凭证\n3. 截止性测试' },
            { id: '2', name: '盘点模板', program: '实物一致性核实', process: '1. 获取明细\n2. 现场观察' }
        ];

        // --- Components ---

        const Layout = ({ left, middle, right }) => {
            const [leftWidth, setLeftWidth] = React.useState(280);
            const [rightWidth, setRightWidth] = React.useState(380);
            
            return (
                <div className="flex h-full w-full relative">
                    <div style={{ width: leftWidth }} className="h-full border-r border-zinc-800 bg-[#0f0f0f] shrink-0 overflow-hidden">{left}</div>
                    <div className="w-1 hover:bg-blue-600 cursor-col-resize z-10 transition-colors" />
                    <div className="flex-1 h-full min-w-0 bg-[#050505] overflow-hidden">{middle}</div>
                    <div className="w-1 hover:bg-purple-600 cursor-col-resize z-10 transition-colors" />
                    <div style={{ width: rightWidth }} className="h-full border-l border-zinc-800 bg-[#0f0f0f] shrink-0 overflow-hidden">{right}</div>
                </div>
            );
        };

        const App = () => {
            const [files, setFiles] = React.useState([]);
            const [paper, setPaper] = React.useState({ program: '', process: '', results: '' });
            const [messages, setMessages] = React.useState([]);
            const [inputValue, setInputValue] = React.useState('');
            const [activeTab, setActiveTab] = React.useState('AI');
            const [isTyping, setIsTyping] = React.useState(false);

            const handleUpload = (e) => {
                const newFiles = Array.from(e.target.files).map(f => ({
                    id: Math.random().toString(36).substr(2, 9),
                    name: f.name,
                    size: (f.size / 1024 / 1024).toFixed(2) + ' MB',
                    isSelected: false
                }));
                setFiles([...newFiles, ...files]);
            };

            const toggleFile = (id) => {
                setFiles(files.map(f => f.id === id ? {...f, isSelected: !f.isSelected} : f));
            };

            const handleSend = async () => {
                if (!inputValue.trim()) return;
                const userMsg = { role: 'user', content: inputValue };
                setMessages([...messages, userMsg]);
                setInputValue('');
                setIsTyping(true);

                try {
                    const ai = new GoogleGenAI({ apiKey: window.process?.env?.API_KEY || '' });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: `作为审计专家，回答：${inputValue}`,
                    });
                    setMessages(prev => [...prev, { role: 'assistant', content: response.text }]);
                } catch (e) {
                    setMessages(prev => [...prev, { role: 'assistant', content: "AI服务暂不可用 (请确保API Key有效)" }]);
                } finally {
                    setIsTyping(false);
                }
            };

            return (
                <div className="flex flex-col h-screen w-full bg-[#050505] overflow-hidden">
                    {/* Header */}
                    <header className="h-16 border-b border-zinc-800 flex items-center justify-between px-6 bg-[#0a0a0a] z-20">
                        <div className="flex items-center space-x-3">
                            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-black">A</div>
                            <span className="font-black tracking-tighter text-lg uppercase italic">AuditPro <span className="text-zinc-600 font-normal">Workbench</span></span>
                        </div>
                        <div className="flex items-center space-x-4">
                            <div className="px-3 py-1 rounded-full bg-green-900/20 text-green-500 border border-green-900/30 text-[10px] font-bold">CORE ACTIVE</div>
                            <div className="w-8 h-8 rounded-full bg-zinc-800 border border-zinc-700 overflow-hidden">
                                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=audit" />
                            </div>
                        </div>
                    </header>

                    {/* Main */}
                    <main className="flex-1 overflow-hidden">
                        <Layout 
                            left={(
                                <div className="p-4 flex flex-col h-full">
                                    <h3 className="text-[10px] font-black text-zinc-500 uppercase tracking-widest mb-4">资料管理</h3>
                                    <label className="mb-4 block">
                                        <div className="w-full py-6 border-2 border-dashed border-zinc-800 rounded-2xl flex flex-col items-center justify-center bg-zinc-900/20 hover:bg-zinc-800/40 cursor-pointer transition-all">
                                            <svg className="w-6 h-6 text-zinc-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                            <span className="text-[10px] font-bold text-zinc-500 uppercase">点击上传</span>
                                        </div>
                                        <input type="file" className="hidden" onChange={handleUpload} multiple />
                                    </label>
                                    <div className="flex-1 overflow-y-auto custom-scrollbar space-y-2">
                                        {files.map(f => (
                                            <div key={f.id} className={`p-3 rounded-xl border flex items-center space-x-3 ${f.isSelected ? 'bg-blue-600/10 border-blue-500/50' : 'bg-zinc-900/20 border-zinc-800'}`}>
                                                <input type="checkbox" checked={f.isSelected} onChange={() => toggleFile(f.id)} className="rounded" />
                                                <div className="min-w-0">
                                                    <p className="text-xs font-bold truncate">{f.name}</p>
                                                    <p className="text-[9px] text-zinc-600">{f.size}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            middle={(
                                <div className="p-8 h-full flex flex-col custom-scrollbar overflow-y-auto">
                                    <div className="flex justify-between items-end mb-8">
                                        <div>
                                            <h2 className="text-2xl font-black italic">审计底稿工作区</h2>
                                            <p className="text-zinc-600 text-xs mt-1">WORKING PAPER DRAFTING v1.0.4</p>
                                        </div>
                                        <button className="px-6 py-2.5 bg-blue-600 text-white rounded-xl text-xs font-black shadow-lg shadow-blue-900/30">保存版本</button>
                                    </div>
                                    <div className="space-y-6">
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black text-zinc-500 uppercase tracking-widest pl-1">01. 审计程序</label>
                                            <input value={paper.program} onChange={e => setPaper({...paper, program: e.target.value})} className="w-full bg-zinc-900/50 border border-zinc-800 rounded-2xl px-5 py-4 text-sm focus:outline-none focus:border-blue-500/50 transition-all" placeholder="输入审计程序..." />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black text-zinc-500 uppercase tracking-widest pl-1">02. 过程记录</label>
                                            <textarea rows={10} value={paper.process} onChange={e => setPaper({...paper, process: e.target.value})} className="w-full bg-zinc-900/50 border border-zinc-800 rounded-2xl px-5 py-4 text-sm focus:outline-none focus:border-blue-500/50 transition-all resize-none" placeholder="记录审计实施细节..." />
                                        </div>
                                    </div>
                                </div>
                            )}
                            right={(
                                <div className="flex flex-col h-full overflow-hidden">
                                    <div className="flex border-b border-zinc-800">
                                        <button onClick={() => setActiveTab('AI')} className={`flex-1 py-4 text-[10px] font-black uppercase tracking-widest ${activeTab === 'AI' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-zinc-600'}`}>AI 交互</button>
                                        <button onClick={() => setActiveTab('ANALYSIS')} className={`flex-1 py-4 text-[10px] font-black uppercase tracking-widest ${activeTab === 'ANALYSIS' ? 'text-purple-500 border-b-2 border-purple-500' : 'text-zinc-600'}`}>非现场分析</button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                                        {activeTab === 'AI' ? (
                                            <div className="space-y-4">
                                                {messages.map((m, i) => (
                                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                        <div className={`max-w-[85%] p-3 rounded-2xl text-[11px] leading-relaxed ${m.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-zinc-800 text-zinc-200 rounded-tl-none'}`}>
                                                            {m.content}
                                                        </div>
                                                    </div>
                                                ))}
                                                {isTyping && <div className="text-zinc-600 text-[10px] animate-pulse">AI 正在思考...</div>}
                                            </div>
                                        ) : (
                                            <div className="flex flex-col items-center justify-center py-20 text-center">
                                                <div className="w-16 h-16 bg-purple-600/10 rounded-3xl flex items-center justify-center mb-4 border border-purple-500/20 animate-float">
                                                    <svg className="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                                                </div>
                                                <h4 className="text-xs font-black uppercase tracking-widest mb-2">数据引擎已就绪</h4>
                                                <button className="w-full py-4 bg-purple-600 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-purple-900/20">启动分析</button>
                                            </div>
                                        )}
                                    </div>
                                    {activeTab === 'AI' && (
                                        <div className="p-4 border-t border-zinc-800 bg-[#0a0a0a]">
                                            <div className="relative">
                                                <textarea value={inputValue} onChange={e => setInputValue(e.target.value)} onKeyDown={e => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())} placeholder="输入指令..." rows={3} className="w-full bg-zinc-900 border border-zinc-800 rounded-2xl p-4 text-xs focus:outline-none focus:border-blue-500/50 resize-none pr-12" />
                                                <button onClick={handleSend} className="absolute right-3 bottom-3 p-2 bg-blue-600 rounded-xl text-white"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg></button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        />
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
